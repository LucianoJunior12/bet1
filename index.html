<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Aposta</title>
</head>
<body>
    <h1>Sistema de Aposta</h1>
    <label for="valorApostado">Valor da Aposta (em Wei):</label>
    <input type="number" id="valorApostado">
    <br>
    <label for="numeroInicial">Número Inicial:</label>
    <input type="number" id="numeroInicial">
    <br>
    <label for="numeroFinal">Número Final:</label>
    <input type="number" id="numeroFinal">
    <br>
    <button onclick="fazerAposta()">Fazer Aposta</button>
    <br>
    <br>
    <label for="novoValorRecompensa">Novo Valor da Recompensa Fixa (em Wei):</label>
    <input type="number" id="novoValorRecompensa">
    <button onclick="definirRecompensaFixa()">Definir Nova Recompensa Fixa</button>

    <div id="resultadoAposta">
        <h2>Resultado da Última Aposta</h2>
        <p>Número Sorteado: <span id="numeroSorteado"></span></p>
        <p>Você <span id="mensagemResultado"></span> a aposta.</p>
    </div>

    <script>
        const CONTRATO_ADDRESS = "0xf85EDDe188d7CF8DAfCdEb4fd92a4a845d8bCaab";
        const CONTRATO_ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "jogador",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "valorApostado",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "numeroInicial",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "numeroFinal",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "numeroSorteado",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "bool",
				"name": "ganhou",
				"type": "bool"
			}
		],
		"name": "Aposta",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_novaRecompensa",
				"type": "uint256"
			}
		],
		"name": "definirRecompensaFixa",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "depositar",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_numeroInicial",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_numeroFinal",
				"type": "uint256"
			}
		],
		"name": "fazerAposta",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "sacarSaldoContrato",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "recompensaFixa",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "saldoContrato",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

        async function fazerAposta() {
            const valorApostado = document.getElementById("valorApostado").value;
            const numeroInicial = document.getElementById("numeroInicial").value;
            const numeroFinal = document.getElementById("numeroFinal").value;

            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            const account = accounts[0];

            const contrato = new ethers.Contract(CONTRATO_ADDRESS, CONTRATO_ABI, signer);
            const transacao = await contrato.fazerAposta(valorApostado, numeroInicial, numeroFinal, {value: valorApostado});
            const resultado = await transacao.wait();

            const eventoAposta = resultado.events.filter(event => event.event === "Aposta")[0];
            const numeroSorteado = eventoAposta.args.numeroSorteado.toNumber();
            const ganhou = eventoAposta.args.ganhou;

            document.getElementById("numeroSorteado").textContent = numeroSorteado;
            document.getElementById("mensagemResultado").textContent = ganhou ? "ganhou" : "perdeu";
        }

        async function definirRecompensaFixa() {
            const novoValorRecompensa = document.getElementById("novoValorRecompensa").value;

            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            const account = accounts[0];

            const contrato = new ethers.Contract(CONTRATO_ADDRESS, CONTRATO_ABI, signer);
            const transacao = await contrato.definirRecompensaFixa(novoValorRecompensa);
            const resultado = await transacao.wait();

            console.log(resultado);
        }
    </script>
</body>
</html>
